---
title: "Задача №112751. Магические порталы"
tags:
  - problems/origin/informatics/112751
  - problem/contest/300607/B
  - problem/contest/200604/E
  - problem/contest/201604/D
  - problem/contest/004201/E
  - problem/contest/202307/D
  - problem/contest/004601/E
---
# Задача №112751. Магические порталы

В некотором королевстве есть $n$ городов, соединенных магическими порталами.
Каждая пара различных городов соединена ровно одним магическим порталом,
позволяющим мгновенно перемещаться из одного города в другой.   
  
Из-за свойств магии, определяющей работу порталов, каждый портал можно
использовать только в одну сторону. Для каждой пары городов $A$ и $B$ известно, можно ли
воспользоваться порталом для перемещения напрямую из $A$ в $B$ или из $B$ в $A$.  
  
Из-за особенностей магических порталов иногда при перемещении жителей
королевства из одного города в другой приходится использовать несколько порталов. Также
могут существовать такие пары городов, что из одного города в другой нельзя добраться,
используя только магические порталы.   
  
Жители королевства называют город совершенным, если из него можно добраться до
любого другого города в королевстве, используя только магические порталы. Пусть
изначально количество совершенных городов в королевстве равно $k$.  
  
Недавно король принял решение выбрать пару городов и изменить разрешенное
направление перемещения по порталу, соединяющему их, на противоположное. Для выбора
лучшего варианта король хочет понять, какое количество совершенных городов может
оказаться в королевстве после перенастройки ровно одного портала.  
  
Для получения этой информации король планирует запросить в министерстве
транспорта соответствующий отчет. Король может запросить либо частичный, либо полный
отчет. Содержимое отчета зависит от параметра $L$, для частичного отчета $L$ = $k$ + 1, для
полного отчета $L$ = 1.  
  
Отчет содержит для каждого целого числа $m$, такого что $m$ ≥ $L$, число таких пар
городов $A$ и $B$, для которых выполняются следующие условия:  
\* исходно магический портал позволяет перемещаться напрямую из города $A$ в
город $B$;  
\* если изменить направление перемещения этого магического портала на
противоположное, чтобы он позволял напрямую перемещаться из города $B$ в
город $A$, то количество совершенных городов в королевстве станет равным $m$.  
  
Таким образом, частичный отчет содержит информацию только о тех способах
перенастройки одного портала, которые строго увеличивают количество совершенных
городов в королевстве. Полный отчет содержит информацию обо всех способах
перенастройки одного портала.  
  
Требуется написать программу, которая по информации о разрешенных направлениях
перемещения с использованием магических порталов, и информации о том, требуется
предоставить частичный или полный отчет, формирует соответствующий отчет и выводит
его в описанном ниже формате.
### Входные данные
Первая строка входного файла содержит два целых числа: $n$ — количество городов в
королевстве (2 ≤ $n$ ≤ 2000) и $p$, равное либо 0, если требуется вывести частичный отчет, либо
1, если требуется вывести полный отчет.  
  
Последующие $n$ строк содержат по $n$ символов, каждый из которых может быть «+»,
«–» или «.», и $i$-я из этих строк описывает магические порталы, соединяющие $i$-й город с
другими городами.  
  
В $i$-й строке $j$-й символ равен «+», если магический портал позволяет напрямую
перемещаться из $i$-го города в $j$-й, равен «–», если магический портал позволяет напрямую
перемещаться из $j$-го города в $i$-й, и равен «.», если $i$ = $j$.
### Выходные данные
Первая строка выходного файла должна содержать одно целое число $k$ — количество
совершенных городов в королевстве.  
  
Если требуется частичный отчет ($p$ = 0), то вторая строка выходного файла должна
содержать ($n$ – $k$) целых неотрицательных чисел, разделенных пробелами, где $i$-е из этих
чисел должно быть равно количеству пар городов, изменение направления портала между
которыми на противоположное приводит к тому, что количество совершенных городов в
королевстве станет равным ($k$ + $i$). Если при этом $k$ = $n$, то вторая строка может
отсутствовать, либо быть пустой.  
  
Если требуется полный отчет ($p$ = 1), то вторая строка должна содержать $n$ целых
неотрицательных чисел, разделенных пробелами, где $i$-е из этих чисел должно быть равно
количеству пар городов, изменение направления портала между которыми на
противоположное приводит к тому, что количество совершенных городов в королевстве
станет равным $i$.
### Примеры
**Входные данные:**
```
5 0
.-+++
+.+++
--.+-
---.+
--+-.
```
**Выходные данные:**
```
1
0 0 0 3
```
**Входные данные:**
```
5 1
.-+++
+.+++
--.+-
---.+
--+-.
```
**Выходные данные:**
```
1
7 0 0 0 3
```